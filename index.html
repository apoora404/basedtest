<!doctype html>
<html lang="ko" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Basedapp Simulator & Analyzer</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root {
      color-scheme: dark;
      --bg: #0e0f12; --panel: #16181d; --border: #242833;
      --text-main: #e8eaee; --text-muted: #98a2af;
      --accent: #ff6a3d; --ok: #2ad7a3; --danger: #ff6b6b;
      --ring: 0 0 0 3px rgba(255,106,61,.35);
      --input-bg: #101217;
    }
    [data-theme='light'] {
      color-scheme: light;
      --bg: #f0f2f5; --panel: #ffffff; --border: #dcdfe3;
      --text-main: #1f2328; --text-muted: #656d76;
      --accent: #f56565; --ok: #38a169; --danger: #e53e3e;
      --ring: 0 0 0 3px rgba(245,101,101,.35);
      --input-bg: #f0f2f5;
    }
    body{ background: var(--bg); color: var(--text-main); transition: background .2s, color .2s; }
    .card{ background: var(--panel); border: 1px solid var(--border); }
    .muted{ color: var(--text-muted); }
    .btn-accent{ background: var(--accent); color: white; }
    .btn-accent:hover{ filter: brightness(1.05); }
    input,select{
      background: var(--input-bg); border: 1px solid var(--border); color: var(--text-main);
      border-radius: 12px; padding: .65rem .8rem; width: 100%;
    }
    input[type="radio"]{ width:auto; margin-right: 0.5rem; }
    input:focus,select:focus{ outline: none; box-shadow: var(--ring); border-color: var(--accent); }
    .num{ font-variant-numeric: tabular-nums; }
    .kv{ display: flex; gap: .5rem; align-items: baseline; }
    .kv .k{ min-width: 10.5rem; color: var(--text-muted); }
    .kv .v{ font-weight: 700; }
    .text-ok{ color: var(--ok); }
    .text-danger{ color: var(--danger); }
    .tab{ padding: .5rem 1rem; border-bottom: 2px solid transparent; color: var(--text-muted); cursor: pointer; transition: color .2s, border-color .2s; }
    .tab.active{ color: var(--accent); border-bottom-color: var(--accent); font-weight: 600; }
  </style>
</head>
<body class="pb-28">
  <header class="max-w-5xl mx-auto px-4 py-7 relative">
    <div class="rounded-3xl border border-[var(--accent)]/60 p-3 mx-auto w-fit">
      <div class="rounded-2xl px-5 py-3 bg-[var(--panel)] text-center">
        <h1 class="text-2xl font-semibold">Basedapp Simulator & Analyzer</h1>
      </div>
    </div>
    <button id="theme-toggle" class="absolute top-8 right-8 p-2 rounded-full bg-[var(--panel)] border border-[var(--border)]">
      <svg id="theme-icon-light" class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.706-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm-.707 7.072l.707-.707a1 1 0 10-1.414-1.414l-.707.707a1 1 0 101.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" fill-rule="evenodd" clip-rule="evenodd"></path></svg>
      <svg id="theme-icon-dark" class="w-6 h-6 hidden" fill="currentColor" viewBox="0 0 20 20"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>
    </button>
  </header>

  <main class="max-w-5xl mx-auto px-4 space-y-6">
    <section class="card rounded-2xl p-4 space-y-4">
      <div class="flex border-b border-[var(--border)]">
        <button id="tabSimulator" class="tab active">목표 시뮬레이터</button>
        <button id="tabAnalyzer" class="tab">거래 분석</button>
      </div>
      
      <div id="simulatorInputs" class="space-y-4 pt-4">
        <p class="text-sm muted">목표 XP를 달성하기 위한 거래량과 횟수를 계산합니다.</p>
        <div class="grid sm:grid-cols-2 gap-x-6 gap-y-4">
            <div class="space-y-4">
                <label class="block"><span class="block text-xs muted">거래 방식</span><select id="simMode"><option value="perps">선물 (Perps)</option><option value="spot">현물 (Spot)</option></select></label>
                <div id="simPupSelector" class="hidden">
                    <span class="block text-xs muted">토큰 종류</span>
                    <div class="flex items-center gap-4 text-sm mt-2">
                        <label class="flex items-center"><input type="radio" name="simSpotType" value="normal" checked> 일반</label>
                        <label class="flex items-center"><input type="radio" name="simSpotType" value="pup"> $PUP (2.25배)</label>
                    </div>
                </div>
                <div>
                    <span class="block text-xs muted mb-2">수수료 등급</span>
                    <div class="flex items-center gap-4 text-sm">
                        <label class="flex items-center"><input type="radio" name="simFeeGrade" value="base_rate" checked> Base</label>
                        <label class="flex items-center"><input type="radio" name="simFeeGrade" value="diamond"> Diamond</label>
                        <label class="flex items-center"><input type="radio" name="simFeeGrade" value="platinum"> Platinum</label>
                    </div>
                </div>
                 <label class="block"><span class="block text-xs muted">목표 XP</span><input id="targetXp" type="number" step="100" placeholder="50000"></label>
            </div>
            <div class="space-y-4">
                <div class="grid grid-cols-2 gap-3">
                    <label class="block"><span class="block text-xs muted">시작 자금 ($)</span><input id="simStartCapital" type="number" step="0.01" placeholder="1000"></label>
                    <div id="simLeverageWrapper"><label class="block"><span class="block text-xs muted">레버리지</span><input id="simLeverage" type="number" value="10" step="1"></label></div>
                </div>
                 <div>
                    <span class="block text-xs muted mb-2">주문 종류</span>
                    <div class="flex items-center gap-4 text-sm">
                        <label class="flex items-center"><input type="radio" name="simOrderType" value="maker" checked> 지정가</label>
                        <label class="flex items-center"><input type="radio" name="simOrderType" value="taker"> 시장가</label>
                    </div>
                </div>
                <label class="block"><span class="block text-xs muted">수수료 Tier</span><select id="simTier"></select></label>
                <label class="block"><span class="block text-xs muted">XP 부스트</span><select id="simBoost"><option value="0">0%</option><option value="25">25%</option><option value="50">50%</option><option value="60" selected>60%</option></select></label>
            </div>
        </div>
        <button id="simulateBtn" class="w-full btn-accent p-2 rounded-xl font-semibold mt-4">시뮬레이션 실행</button>
      </div>

      <div id="analyzerInputs" class="hidden space-y-4 pt-4">
        <p class="text-sm muted">실제 거래 후 누적된 거래량을 입력하여 효율을 분석합니다.</p>
        <div class="grid lg:grid-cols-2 gap-x-6 gap-y-4">
            <div class="space-y-4">
                <div class="grid grid-cols-2 gap-3">
                    <label class="block"><span class="block text-xs muted">이전 거래량 (누적, $)</span><input id="prevVol" type="number" step="0.01"></label>
                    <label class="block"><span class="block text-xs muted">현재 거래량 (누적, $)</span><input id="currVol" type="number" step="0.01"></label>
                </div>
                 <div class="space-y-2">
                    <span class="block text-xs muted">주문 종류</span>
                    <div class="flex items-center gap-4 text-sm">
                        <label class="flex items-center"><input type="radio" name="checkOrderType" value="maker" checked> 지정가</label>
                        <label class="flex items-center"><input type="radio" name="checkOrderType" value="taker"> 시장가</label>
                    </div>
                </div>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="block"><span class="block text-xs muted">거래 방식</span><select id="checkMode"><option value="perps">선물 (Perps)</option><option value="spot">현물 (Spot)</option></select></label>
                    <div id="checkPupSelector" class="hidden mt-2">
                        <span class="block text-xs muted">토큰 종류</span>
                        <div class="flex items-center gap-4 text-sm mt-2">
                            <label class="flex items-center"><input type="radio" name="checkSpotType" value="normal" checked> 일반</label>
                            <label class="flex items-center"><input type="radio" name="checkSpotType" value="pup"> $PUP (2.25배)</label>
                        </div>
                    </div>
                </div>
                <label class="block"><span class="block text-xs muted">XP 부스트</span><select id="checkBoost"><option value="0">0%</option><option value="25">25%</option><option value="50">50%</option><option value="60" selected>60%</option></select></label>
                <div>
                    <span class="block text-xs muted mb-2">수수료 등급</span>
                    <div class="flex items-center gap-4 text-sm">
                        <label class="flex items-center"><input type="radio" name="checkFeeGrade" value="base_rate" checked> Base</label>
                        <label class="flex items-center"><input type="radio" name="checkFeeGrade" value="diamond"> Diamond</label>
                        <label class="flex items-center"><input type="radio" name="checkFeeGrade" value="platinum"> Platinum</label>
                    </div>
                </div>
                 <label class="block"><span class="block text-xs muted">수수료 Tier</span><select id="checkTier"></select></label>
            </div>
        </div>
        <button id="analyzeBtn" class="w-full btn-accent p-2 rounded-xl font-semibold mt-2">분석하기</button>
      </div>
    </section>

    <section id="resultCard" class="card rounded-2xl p-4">
        <h3 class="font-semibold text-lg">결과</h3>
        <div id="out" class="space-y-2 mt-3"></div>
    </section>
  </main>
  
  <footer class="mt-6 py-4 border-t border-[var(--border)] text-center text-sm text-[var(--muted)]">
    2025 Brought to you by
    <a href="https://twitter.com/no_gongju" target="_blank" rel="noopener"
       class="ml-1 text-[var(--accent)] hover:underline">@no_gongju</a>
  </footer>

  <script>
    const FEES = {
        perps: {
            base_rate: [
                { name: "Tier 0", taker: 0.00045, maker: 0.00015 }, { name: "Tier 1 (>5M)", taker: 0.00040, maker: 0.00012 },
                { name: "Tier 2 (>25M)", taker: 0.00035, maker: 0.00008 }, { name: "Tier 3 (>100M)", taker: 0.00030, maker: 0.00004 },
                { name: "Tier 4 (>500M)", taker: 0.00028, maker: 0.00000 }, { name: "Tier 5 (>2B)", taker: 0.00026, maker: 0.00000 },
                { name: "Tier 6 (>7B)", taker: 0.00024, maker: 0.00000 }
            ],
            diamond: [
                { name: "Tier 0", taker: 0.000270, maker: 0.000090 }, { name: "Tier 1 (>5M)", taker: 0.000240, maker: 0.000072 },
                { name: "Tier 2 (>25M)", taker: 0.000210, maker: 0.000048 }, { name: "Tier 3 (>100M)", taker: 0.000180, maker: 0.000024 },
                { name: "Tier 4 (>500M)", taker: 0.000168, maker: 0.000000 }, { name: "Tier 5 (>2B)", taker: 0.000156, maker: 0.000000 },
                { name: "Tier 6 (>7B)", taker: 0.000144, maker: 0.000000 }
            ],
            platinum: [
                { name: "Tier 0", taker: 0.000315, maker: 0.000105 }, { name: "Tier 1 (>5M)", taker: 0.000280, maker: 0.000084 },
                { name: "Tier 2 (>25M)", taker: 0.000245, maker: 0.000056 }, { name: "Tier 3 (>100M)", taker: 0.000210, maker: 0.000028 },
                { name: "Tier 4 (>500M)", taker: 0.000196, maker: 0.000000 }, { name: "Tier 5 (>2B)", taker: 0.000182, maker: 0.000000 },
                { name: "Tier 6 (>7B)", taker: 0.000168, maker: 0.000000 }
            ]
        },
        spot: {
            base_rate: [
                { name: "Tier 0", taker: 0.00070, maker: 0.00040 }, { name: "Tier 1 (>5M)", taker: 0.00060, maker: 0.00030 },
                { name: "Tier 2 (>25M)", taker: 0.00050, maker: 0.00020 }, { name: "Tier 3 (>100M)", taker: 0.00040, maker: 0.00010 },
                { name: "Tier 4 (>500M)", taker: 0.00035, maker: 0.00000 }, { name: "Tier 5 (>2B)", taker: 0.00030, maker: 0.00000 },
                { name: "Tier 6 (>7B)", taker: 0.00025, maker: 0.00000 }
            ],
            diamond: [
                { name: "Tier 0", taker: 0.000420, maker: 0.000240 }, { name: "Tier 1 (>5M)", taker: 0.000360, maker: 0.000180 },
                { name: "Tier 2 (>25M)", taker: 0.000300, maker: 0.000120 }, { name: "Tier 3 (>100M)", taker: 0.000240, maker: 0.000060 },
                { name: "Tier 4 (>500M)", taker: 0.000210, maker: 0.000000 }, { name: "Tier 5 (>2B)", taker: 0.000180, maker: 0.000000 },
                { name: "Tier 6 (>7B)", taker: 0.000150, maker: 0.000000 }
            ],
            platinum: [
                { name: "Tier 0", taker: 0.000490, maker: 0.000280 }, { name: "Tier 1 (>5M)", taker: 0.000420, maker: 0.000210 },
                { name: "Tier 2 (>25M)", taker: 0.000350, maker: 0.000140 }, { name: "Tier 3 (>100M)", taker: 0.000280, maker: 0.000070 },
                { name: "Tier 4 (>500M)", taker: 0.000245, maker: 0.000000 }, { name: "Tier 5 (>2B)", taker: 0.000210, maker: 0.000000 },
                { name: "Tier 6 (>7B)", taker: 0.000175, maker: 0.000000 }
            ]
        }
    };
    const BUILDER_FEE_RATES = {
        perps: 0.00025,
        spot: 0.0005 
    };
    const XP_PER_DOLLAR_BASE = {
        perps: 0.02525,
        spot_normal: 0.101,
        spot_pup: 0.22725
    };

    const $ = (id) => document.getElementById(id);
    const d2 = (n) => Number(n || 0).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    const d_auto = (n) => Number(n || 0).toLocaleString(undefined, { maximumFractionDigits: 4 });
    
    function getBaseXpRate(mode, spotType) {
        if (mode === 'perps') return XP_PER_DOLLAR_BASE.perps;
        return spotType === 'pup' ? XP_PER_DOLLAR_BASE.spot_pup : XP_PER_DOLLAR_BASE.spot_normal;
    }
    
    function populateTiers(mode, feeGrade, tierElementId) {
        const tierSelect = $(tierElementId);
        tierSelect.innerHTML = '';
        if (FEES[mode] && FEES[mode][feeGrade]) {
            FEES[mode][feeGrade].forEach((t, i) => {
                tierSelect.innerHTML += `<option value="${i}">${t.name}</option>`;
            });
        }
    }

    function runSimulation() {
        const mode = $('simMode').value;
        const spotType = document.querySelector('input[name="simSpotType"]:checked').value;
        const orderType = document.querySelector('input[name="simOrderType"]:checked').value;
        const feeGrade = document.querySelector('input[name="simFeeGrade"]:checked').value;
        const tier = Number($('simTier').value || 0);
        const baseXP_rate = getBaseXpRate(mode, spotType);

        const targetXp = Number($('targetXp').value || 0);
        const boost = Number($('simBoost').value || 0);
        const startCapital = Number($('simStartCapital').value || 0);
        const leverage = mode === 'perps' ? Number($('simLeverage').value || 1) : 1;
        
        if (targetXp <= 0) { $('out').innerHTML = `<div class="text-sm muted">목표 XP를 입력해주세요.</div>`; return; }

        const boostedXP_rate = baseXP_rate * (1 + boost / 100);
        const neededVol = boostedXP_rate > 0 ? targetXp / boostedXP_rate : 0;
        
        let tradeCountText = "—";
        if (startCapital > 0 && leverage > 0) {
            const positionSize = startCapital * leverage;
            tradeCountText = positionSize > 0 ? `${d2(neededVol / positionSize)} 회` : "—";
        }
        
        const feeRateKey = mode === 'spot' ? `${orderType}_avg` : orderType;
        const feeRate = FEES[mode][feeGrade][tier][feeRateKey];

        const totalFeePaid = neededVol * feeRate;
        const builderFeePaid = neededVol * BUILDER_FEE_RATES[mode]; // Builder fee is constant regardless of tier/grade
        const hyperliquidFeePaid = totalFeePaid - builderFeePaid;
        const rebateAmt = builderFeePaid * 0.60;
        const netFeePaid = totalFeePaid - rebateAmt;

        const rows = [
            // ... (결과 HTML 생성 로직은 이전과 동일)
        ];
        $('out').innerHTML = `<div class="space-y-1">${rows.join("")}</div>`;
    }

    function runAnalyzer() {
        // ... (runAnalyzer 로직도 위와 같이 수정)
    }
    
    function switchTab(tabName) { /* ... */ }
    function toggleLeverage() { /* ... */ }
    function togglePupSelector() { /* ... */ }
    function applyTheme(theme) { /* ... */ }
    function toggleTheme() { /* ... */ }

    document.addEventListener('DOMContentLoaded', () => {
        populateTiers('perps', 'base_rate', 'simTier');
        populateTiers('perps', 'base_rate', 'checkTier');
        
        // ... (모든 이벤트 리스너 설정)
        
        document.querySelectorAll('input[name="simFeeGrade"]').forEach(radio => {
            radio.addEventListener('change', () => populateTiers($('simMode').value, radio.value, 'simTier'));
        });
        $('simMode').addEventListener('change', () => {
            const grade = document.querySelector('input[name="simFeeGrade"]:checked').value;
            populateTiers($('simMode').value, grade, 'simTier');
            toggleLeverage(); 
            togglePupSelector();
        });

        // Analyzer용 이벤트 리스너도 동일하게 추가
    });
  </script>
</body>
</html>
